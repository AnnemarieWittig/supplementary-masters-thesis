= Aggregation Scripts

This directory contains the script and configuration file used to aggregate, merge, and visualize the analysis results from the link:../AnalysisScripts/[AnalysisScripts] directory. The main purpose is to combine individual metric results into comprehensive visualizations and summary reports to create the overview graphics and tables included in the thesis.

== Overview

The aggregation process takes the individual CSV files generated by each analysis script and combines them into:

* **Merged effect size matrices** - Combined results across all metrics and repositories/participants
* **Effect size heatmaps** - Visual representation of effect sizes with trend information
* **Statistical tables** - Different aggregated statistics regarding the distribution of effect sizes, slope directions, etc.

== Main Script

=== link:merge_results.ipynb[`merge_results.ipynb`] - Primary Aggregation Script

This Jupyter notebook is the core aggregation script that performs the following operations:

==== Data Loading and Preprocessing
* **Loads all CSV files** from the `RESULTS_DIRECTORY/metric_calculation_{BUCKET_SIZE}/` directory
* **Normalizes metric names** by removing bucket size suffixes (e.g., `_per_90_days`) and using the metric mapping json file (if existent)
* **Applies participant filtering** using `PARTICIPANTS_TO_REMOVE` from environment variables
* **Performs repository/participant renaming** using the mapping.json file

==== Effect Size Aggregation
* **Extracts effect sizes** (Cliff's Delta values) from each analysis result
* **Merges all metrics** into a single comprehensive matrix

==== Trend Analysis Features
* **Pre/Post Slope Calculation** - Computes linear trends for periods before and after AI tool introduction
* **Magnitude Assessment** - Determines the absolute magnitude of changes
* **Direction Indicators** - Uses arrows (↑↓→) to show trend directions

==== Visualization Generation
* **Effect Size Heatmaps** - Color-coded matrices showing impact across metrics and repositories
* **Grouped Metric Organization** - Groups metrics by category (Commit, File-Level, Pull Requests, Other)

== Configurations

=== link:metric_mapping.json[`metric_mapping.json`] - Metric Display Configuration

This JSON file defines how metrics are displayed in visualizations:

[source,json]
----
{
    "metric_name": {
        "label": "Display abbreviation",
        "group": "Category name to sort by"
    }
}
----

The labels and groups used in the provided in this json file are according to the abbreviations presented in the thesis.


=== Environment Dependencies

The script requires the same `.env` configuration as the AnalysisScripts:

[source,env]
----
RESULTS_DIRECTORY=/path/to/analysis/results
BUCKET_SIZE=90
PARTICIPANTS_TO_REMOVE=['participant1','participant2']
MAPPING_PATH=/path/to/mapping.json
PER_PERSON=True
----

== Generated Outputs

=== CSV Files
* **`merged_metrics_{BUCKET_SIZE}.csv`** - Combined effect sizes for all metrics and repositories/participants

=== PDF Visualizations  
* **link:all_averages.pdf[`all_averages.pdf`]** - Comprehensive comparison of average effects across all metrics
* **link:ir_visualization.pdf[`ir_visualization.pdf`]** - IR/participant-level visualizations
* **link:osr_visualization.pdf[`osr_visualization.pdf`]** - OSR analysis visualizations

== Visualization Features

=== Heatmap Components
* **Color Coding** - Effect sizes mapped to colors (red = negative impact, green = positive impact)
* **Effect Size Values** - Numerical Cliff's Delta values displayed in cells
* **Trend Arrows** - Visual indicators for pre/post-introduction trends:
** ↑ = Increasing trend
** ↓ = Decreasing trend  
** → = Stable trend
* **Slope Values** - Numerical slope values showing rate of change
* **Group Separators** - Visual boundaries between metric categories

=== Layout Options
* **Standard Layout** - Repositories/participants as rows, metrics as columns
* **Transposed Layout** - Metrics as rows, repositories/participants as columns
* **Absolute Averages** - Additional row showing absolute average effects
* **Statistical Masking** - Non-significant results can be masked or highlighted

== Usage Workflow

=== Step 1: Run Analysis Scripts
Ensure all desired analysis scripts have been executed and results are available in the `RESULTS_DIRECTORY`.

=== Step 2: Configure Environment
Set up the `.env` file with appropriate paths and filtering parameters.

=== Step 3: Execute Aggregation
Run the `merge_results.ipynb` notebook:
[source,bash]
----
jupyter notebook merge_results.ipynb
----

== Integration with Thesis

The aggregated results serve as the primary source for:

* **Summary tables** showing overall effect sizes across all metrics
* **Publication figures** demonstrating the comprehensive impact analysis
* **Comparative analysis** between different development contexts

as presented in the results section in the thesis.